% Relevant to me:

% $\int_A := \int_{inner} \int_{outer}$, defined for both forms $\Omega(A, L)$ and $\Omega(A)$ (for the decomposition? Or when is that used?). Used for below:

%     \begin{itemize}
    
%     \item For $\hat \omega \in \Omega^1(A, L)$, define $S_{Gauge}[\hat \omega] = (\hat R, \hat R) = \int_A h(\hat R, \star \hat R)$.
    
%     \item For $\phi \in \Gamma(E)$ and $\hat \omega$ as above, \[S_{Matter}[\phi, \hat \omega] := (\hat \nabla^E \phi, \hat \nabla^E \phi)\]
    
%     \end{itemize}
    
% That means the star is needed for: 
%     \begin{itemize}
        
%     \item $\star \hat R$, where $\hat R \in \Omega^2(A, L)$
    
%     \item $\star \hat \nabla^E \phi$ for $\hat \nabla^E \phi \in \Omega^1(A, E)$
    
%     \item Some other forms of the same type that are generated by the decomposition
        
%     \end{itemize}

% {
% \color{gray}
%     Outline:
    
%     \begin{itemize}
    
%     \item Inner Metrics and Metrics on Representation Vector Bundle of Transitive Lie Algebroids
    
%         \begin{itemize}
            
%         \item $h^E$ on $E$ symmetric bilinear form.
        
%             \begin{itemize}
                
%             \item e.g. Defn: inner metric
            
%             \item $h^E_{uv}$
            
%             \item $h^E_i = G \, G h^E_j$
                
%             \end{itemize}
        
%         \item $h^E$ on $\Omega^\bullet (A, E)$.
            
%             \begin{itemize}
                
%             \item $h^E(\alpha, \beta) = \alpha^u \wedge \beta^v h_{uv}$ (or, slightly more generally, multiplicatio by $0$ form gets out with $h$)
                
%             \end{itemize}
            
%         \item $\phi_L$-compatible $E$-metric: $h^E(\phi_L(\eta) \mu_1, \mu_2) + h^E(\mu_1, \phi_L(\eta)\mu_2) = 0$
        
%             \begin{itemize}
                
%             \item e.g. Defn: Killing metric
                
%             \end{itemize}
        
%         \item (Needed?) Locally constant metric. Compatible with $d$'s.
        
%         \end{itemize}
    
%     \item Symmetric Bilinear forms on Transitive Lie Algebroids
    
%         \begin{itemize}
            
%         \item $\hat g \to h$. Defn: Inner part
        
%             \begin{itemize}
                
%             \item Defn: Inner nondegenerate metric on $A$
                
%             \end{itemize}
        
%         \item $g \to \hat g$. Null inner part
        
%         Let $\nabla$ be an ordinary connection on $A$. Then:
        
%         \item $h \to \hat g$
        
%         \item $\hat g \to g$
            
%         \item Theorem: Inner nondegenerate bilsymform iff $(g, h, \nabla)$ with $h$ nondeg. (i.e. actual metric) and $\nabla$ ordinary connection. Proof: Adaptation of Riesz representatio theorem (of Hilbert spaces, say).
        
%         Such $\hat g \equiv (g, h, \nabla)$ assumed from now on.
        
%         \item Local:
        
%             \begin{itemize}
                
%             \item $\hat g = g_{\mu \nu} dx^\mu dx^\nu + h_{ab} \alg a^a \alg a^b$
                
%             \end{itemize}
        
%         \end{itemize}
    
%     \item Inner Orientability and Orientability
    
%         \begin{itemize}
            
%         \item Defn: inner orientable transitive LAoid. Suppose basis such that $|G| \geq 0$
        
%         From now on $\hat g \equiv (g, h, \nabla)$ (inner n.d.) and inner orientable
        
%         \item Defn: Inner volume form $\omega_{h, \alg a}$. Exists globally since it transforms well.
        
%         \item Inner integration:
        
%             \begin{itemize}
                
%             \item (needed?) Of $L$-valued forms
            
%             \item of $\bb K$-valued forms
            
%             \item It is the factor of $\sqrt{|h|} \epsilon^1 \wedge \cdots \wedge \epsilon^n$. In particular, it doesn't actually depend on $\nabla$ (nor $g$), only on $h$.
                
%             \end{itemize}
        
%         --------------
        
%         \item Defn: Orientable. From now on $\hat g \equiv (g, h, \nabla)$ (inner n.d.) and orientable.
        
%         \item Defn: Integration on $A$: $\Omega^\bullet(A) \to \bb K$ ONLY (or at least all what we need)
        
%         \item Defn: $\langle , \rangle \to \bb K := \int _A h^E(\cdot, \cdot)$ of $E$-valued forms given $h^E$ metric. Nondeg. since $h^E$ nondeg.
        
%         \end{itemize}
    
%     \item Horizontal Metrics and Hodge-$*$ Operator
    
%     From now on $\hat g \equiv (g, h, \nabla)$ and orientable and nondegenerate i.e. $\hat g$ a metric on $A$ and $A$ orientable.
    
%         \begin{itemize}
            
%         \item Defn: volume form. Never $0$.
        
%         \item Defn: $\hat g^{-1}(\alpha, \beta) \in C^\infty(M)$ for $\alpha, \beta \in  \Omega^p(A)$. Then:
        
%         \item Defn: $\hat g^{-1}_{h^E}(\alpha, \beta) \in C^\infty(M)$ for $\alpha, \beta \in \Omega^p(A, E)$ given $E$-metric (i.e. nondeg.) $h^E$.
        
%             \begin{itemize}
                
%             \item Locally: $\hat g^{-1}_{h^E}(\alpha, \beta) = (h^E)_{uv} g^{\mu_1 \nu_2} \cdots h^{a_s b_s} \alpha^u_{\mu_1 \dots a_s} \beta^v_{\nu_1 \dots b_s} $ 
            
%             \item Then define $\beta^\# = \beta_u^{\mu_1 \dots a_s} \tilde e^u \nabla_{\mu_1}\wedge \cdots \wedge (-E_{a_s}) \in \Omega^{p*}_{U_i}(A, E)$ where $\beta_u^{\mu_1 \dots a_s} := (h^E)_{uv} g^{\mu_1 \nu_2} \cdots h^{a_s b_s} \beta^v_{\nu_1 \dots b_s}$. Pretty sure it transforms well TODO. Then $\hat g^{-1}_{h^E}(\alpha, \beta) = \alpha^a_{\mu_1 \dots a_s} \beta_a^{\mu_1 \dots a_s}$.
                
%             \end{itemize}
        
%         \item Hodge-$*$ of $E$-valued forms: Defined such that $h^E(\alpha, *\beta) = \hat g^{-1}_{h^E}(\alpha, \beta) vol$
        
%             \begin{itemize}
                
%             \item In particular, for $\bb K$-valued: $\alpha \wedge *\beta =\hat g^{-1}(\alpha, \beta) vol$
                
%             \end{itemize}
%         Given by formula $2.6$: $\cdots$. Easy to transforms well, so it is globally defined.
        
%         \item Defn: $(,): \Omega^p(A, E) \times \Omega^p(A, E) \to \bb K := \langle \cdot , * \cdot \rangle = \int_A h^E(\cdot, * \cdot)$.
        
%         \item Theorem: In a trivialization of $A$:
%         \begin{equation}
%             (\alpha, \beta) = (-1)^n \int_M \sqrt{|g|} dx^1 \wedge \cdots \wedge dx^m \sum_{r + s = p} (-1)^{s(m-s)} (m-r)! (n-s)! \times \alpha^a_{\mu_1 \dots a_s} \beta_a^{\mu_1 \dots a_s}.
%         \end{equation}
            
%         \end{itemize}
        
%     \end{itemize}

% }

The formulation of a gauge theory on a transitive Lie algebroid $A$ will be made through the action functional $S[\mu, \hat \omega]$ of the theory, which will be the ``spacetime'' integral of the Lagrangian density, which is, in turn, the inner integral (definition \ref{definitionInner}) of a scalar valued form on $A$, a form found as the a product of vector valued forms induced by a metric on the representation vector bundle.

%Let every vector space, and hence every vector bundle, be over the field $\bb K$, where $\bb K$ is one of $\RR$ or $\CC$. 
Throughout this chapter let $0 \to L \xrightarrow{j} A \xrightarrow{a} TM$ be a transitive Lie algebroid for the transitive Lie algebroid $A$ over the manifold $M$.

Let $\{(U_i, \psi_i: U_i \times \alg g \to L|_{U_i}, \nabla^{0, i}: TU_i \to A|_{U_i})\}_{i \in I}$ be a Lie algebroid atlas for $A$, where $\alg g$ is a Lie algebra with basis $\{E_a\}_{a = 1, \dots, n}$ and associated dual basis $\{\epsilon^a\}_{a = 1, \dots, n}$.

Also, let $E$ be a vector bundle over $M$ on which $A$ is represented by $\phi: A \to \alg D(E)$, with vertical component $\phi_L: L \to \End(E)$. Suppose that $E$ is trivialized over each $U_i$, $i \in I$, by the vector bundle isomorphisms $\beta_i: U_i \times V \to E|_U$, where $V$ is a vector space with basis $\{e_u\}_{u = 1, \dots, t}$ and associated dual basis $\{\tilde e_u\}_{u = 1, \dots, t}$.

\section{Degenerate Metrics on Representation Vector Bundles and Inner Metrics}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{definition}
    Let $E$ be any vector bundle over $M$. \emph{A degenerate metric on $E$} on $E$ is a symmetric vector bundle map $h^E: E \otimes E \to \bb R$. If $h^E$ is non-degenerate, i.e. if $h^E(\mu, \mu) = 0$, only if $\mu = 0$, then $h^E$ is called \emph{a metric on $E$}.
    
    In the case that $E = L$ the adjoint Lie algebroid of $A$, we also use the names \emph{degenerate inner metric on $A$} and \emph{inner metric on $A$}, respectively.
\end{definition}

In contrast to the notations in \cite{Fournel2011, Fournel2013}, we have called ``nondegenerate metric'' what they call ``metric'' to distinguish the degenerate and nondegenerate cases. Notice that a (degenerate) metric on $E$ is equivalent to a $C^\infty(M)$-linear map $h^E: \Gamma(E) \otimes \Gamma(E) \to C^\infty(M)$ which is a field of symmetric bilinear forms if $h^E$ is degenerate, and a field of metrics in the non-degenerate case. We now return to consider $E$ as a representation vector bundle of $A$.

For the rest of the chapter, let $h^E$ be a degenerate metric on $E$ and let $h$ be a degenerate inner metric on $A$.

\begin{definition}
    Over the trivializing neighborhood $U_i$, \emph{the components of $h^E$ with respect to the basis $\{e_u\}$}, with $u, v = 1, \dots$, are the functions $h^{E, i}_{u, v}:= h^E|_{U_i}(\beta_i(e_u),\beta_i(e_v)) \in C^\infty(U_i)$, where $e_u$ and $e_v$ are the corresponding constant $V$-valued functions on $U_i$.
\end{definition}

In particular, $h_{ab}$ are the components of $h$ with respect to the basis $\{E_a\}$, $a, b = 1, \dots, n$. Notice that, in contrast to the components of forms, the components of a (degenerate) metric are symmetric on the indices.

\begin{proposition}\label{propositionTransformationLawMetricHGeneralBUndleRepresentation}
Let ${H^i_j}^u_v = \tilde e^u(\beta^i_j(e_v))$, for $i, j \in I$ and $u, v \in \{1, \dots, t\}$ be the matrix representation of the transition function of $E$ from $U_j$ to $U_i$. Then,
\begin{equation}
    h^{E, j}_{u_1 u_2} = {H^i_j}^{v_1}_{u_1}{H^i_j}^{v_2}_{u_2} h^{E, i}_{v_1 v_2}
\end{equation}
for $u_1, u_2, v_1, v_2 \in \{1, \dots, t\}$.
\end{proposition}
\begin{proof}
\begin{align*}
    h^{E, j}_{u_1 u_2} 
        &= h^E(\beta_j(e_{u_1}),\beta_j(e_{u_2})) \\
        &= h^E(\beta_i \comp \beta^i_j(e_{u_1}), \beta_i \comp \beta^i_j(e_{u_2})\\
        &= h^E({H^i_j}^{v_1}_{u_1} \beta_i(e_{u_2}), {H^i_j}^{v_1}_{u_1} \beta_i(e_{u_2}))\\
        &= {H^i_j}^{v_1}_{u_1}{H^i_j}^{v_2}_{u_2} h^{E, i}_{v_1 v_2}.
\end{align*}
\end{proof}
Recall that the transition functions of $L$ are denoted by $\alpha^i_j$ and its matrix representation with respect to $\{E_a\}_{a = 1, \dots, n}$ is denoted by ${G^i_j}^a_b$.

\begin{definition}
    Given a degenerate metric $h^E$ on the representation vector bundle $E$ of $A$, let us induce the map (also denoted by $h^E$):
    \begin{equation}
        h^E: \Omega^p(A, E) \otimes \Omega^q(A, E) \to \Omega^{p+q}(A)
    \end{equation}
    for all $p, q \in \ZZ_{\geq 0}$, to be the skew-symmetric $C^\infty(M)$-linear map defined by
    \begin{multline}
        h^E(\omega, \eta)(\oid X_1, \dots, \oid X_{p+q}) :=\\ \frac{1}{p!q!} \sum_{\sigma \in Sym_{p+q}} 
        h^E\left( \omega(\oid X_{\sigma(1)}, \dots, \oid X_{\sigma(p)}),  \eta(\oid X_{\sigma(p+1)}, \dots, \oid X_{\sigma_{p+q}}) \right),
    \end{multline}
    for all $\omega \in \Omega^p(A, E)$, $\eta \in \Omega^q(A, E)$, and $\oid X_1, \dots, \oid X_{p+q} \in A$.
\end{definition}

\begin{proposition}
Let $\alpha, \beta \in \Omega_{U_i}^\bullet(A)$, and let $\mu, \nu \in \Gamma_{U_i}(E) = \Omega^0_{U_i}(A, E)$. Then
\begin{equation}
    h^E(\mu \alpha, \nu \beta) = h^E(\mu, \nu) \, \alpha \wedge \beta.
\end{equation}
\end{proposition}
\begin{proof}
This is a direct consequence of the bilinearity of $h^E$  and how the formula for $h^E$ applied to forms is a generalization of the formula for the wedge product.
\begin{align*}
    h^E(\mu \alpha, \nu \beta)&(\oid X_1, \dots, \oid X_{p+q})\\
    &=\frac{1}{p!q!} \sum_{\sigma \in Sym_{p+q}} h^E\left( \mu \omega(\oid X_{\sigma(1)}, \dots, \oid X_{\sigma(p)}),  \nu \eta(\oid X_{\sigma(p+1)}, \dots, \oid X_{\sigma_{p+q}}) \right) \\
    &= \frac{1}{p!q!} \sum_{\sigma \in Sym_{p+q}} 
        h^E\left( \mu ,  \nu  \right) 
        \omega(\oid X_{\sigma(1)}, \dots, \oid X_{\sigma(p)}) \eta(\oid X_{\sigma(p+1)}, \dots, \oid X_{\sigma_{p+q}})\\
    &= h^E(\mu, \nu) \, (\omega \wedge \eta)(\oid X_1, \dots, \oid X_{p+q}).
\end{align*}
\end{proof}

The previous proposition may be applied to the components of $E$-valued forms on each $U_i$ with respect to the basis $\{e_u\}$, since then $\omega = \omega^u e_u$ and $\eta = \eta^v e_v$ with $\omega^u$ and $\eta^v$ are scalar valued forms; hence
\begin{equation}\label{equationLocalhProductOfMetrics}
    h^E|_{U_i}(\omega, \eta) = h^{E,i}_{uv}\,\omega^u \wedge \eta^v 
\end{equation}

The following definition will be important for the important property of a gauge theory: the ```gauge invariance'' of the action functional.

\begin{definition}
A degenerate metric $h^E$ on $E$ is called \emph{compatible with the representation} if
\begin{equation*}
    h^E(\phi_L(\eta) \mu_1, \mu_2) + h^E(\mu_1, \phi_L(\eta)\mu_2) = 0,
\end{equation*}
for all $\eta \in L_m$ and $\mu_1, \mu_2 \in E_m$ for all $m \in M$.

In the case that $E$ is the adjoint Lie algebroid $L$, we also say that \emph{$h$ is a Killing degenerate metric}.
\end{definition}

Since the representation of $A$ on $L$ is is the adjoint representation, a Killing inner (degenerate) metric $h$ satisfies, for all $m \in M$, $\eta, \theta, \gamma \in L_m$:
\begin{equation}
    h([\eta, \theta], \gamma) = h(\theta, [\eta, \gamma]) = 0.
\end{equation}

\section{Degenerate Metrics}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{definition}
\emph{The inner part of $\hat g$} is the degenerate inner metric \begin{equation}
    h := j^*g.
\end{equation} If $h$ is non-degenerate, $\hat g$ is called \emph{an inner non-degenerate metric on $A$}.
\end{definition}

Let $g$ be a (degenerate) metric on $TM$, i.e. a (degenerate) metric on $M$, then we may define a degenerate metric $\hat g$ on $A$ by
\begin{equation}
    \hat g = a^* g;
\end{equation}
this is a degenerate metric on $A$ since its inner part is null.

\begin{definition}
Let $\nabla: TM \to A$ be an ordinary connection on $A$ with induced connection form $\alg a \in \Omega^1(A, L)$. Then:
    \begin{itemize}
    
    \item Given an inner degenerate metric $h$ on $A$, \emph{the degenerate metric induced by $\nabla$} is
    \begin{equation}
        \hat g := \alg a^* h;
    \end{equation}
    this metric has $h$ as inner part.
    
    \item Given a degenerate metric $\hat g$ on $A$, \emph{the tangent degenerate metric induced by $\nabla$} is the degenerate metric $g$ on $TM$:
    \begin{equation}
        g := \nabla^* \hat g.
    \end{equation}
    
    \end{itemize}
\end{definition}

\begin{theorem}
An inner non-degenerate metric $\hat g$ on $A$ is equivalent to a triple $(g, h, \nabla)$ through the equation
\begin{equation}
    \hat g(\oid X, \oid Y) = g(a(\oid X), a(\oid Y)) + h(\alg a(\oid X), \alg a(\oid Y));
\end{equation}
where $g$ is a degenerate metric on $TM$, $h$ is an inner non-degenerate metric on $A$ and $\nabla$ is an ordinary connection on $A$ with associated connection $1$-form $\alg a$. In particular, $h$ is the inner part of $\hat g$ and $g$ is the tangent degenerate metric on $TM$ induced by the connection.
\end{theorem}
\begin{proof}
For a given triple $(g, h, \nabla)$, the corresponding degenerate metric is precisely $\hat g = a^*g + \alg a^* h$.

For the converse, let $\hat g$ be an inner non-degenerate metric on $A$. Then, let $h$ be the inner part of $\hat g$. We now need to see that an inner non-degenerate metric induces an ordinary connection $\nabla$ for which the vertical bundle of $A$ and the horizontal bundle induced by the connection are orthogonal, i.e. a connection such that
\begin{align}
    \hat g(\nabla_X, j(\eta)) &= 0,& \text{for all $X \in TM$ and $\eta \in L$};
\end{align} then, $g$ will simply be the tangent degenerate metric induced by $\hat g$. To prove this an argument adapted from the proof of Riesz representation theorem can be followed \cite{Fournel2013}.
\end{proof}


Suppose that on $U_i$ there is are coordinates $x^\mu: U_i \to \RR$ for $M$, with $\mu, \nu \in \{1, \dots, m\}$. Let $\hat g$ be an inner non-degenerate metric on $A$ associated to the triple $(g, h, \nabla)$. Then, with respect to the local frame $\{\nabla_\mu, -E_a\}$ of $TU_i \times \alg g$, dual to $\{dx^\mu, \alg a^a\}$, the following is true for the following scalar valued functions, called \emph{the local components of $\hat g$ with respect to the coordinates $x^\mu$ and the basis $\{E_a\}$} of $\alg g$, where $\mu, \nu = 1, \dots, m$ and $a, b = 1, \dots, n$:
\begin{align*}
    \hat g^i_{\mu \nu,}& := \hat g^i(\nabla_\mu, \nabla_\nu) = \delta_{\mu \nu}\\
    \hat g^i_{\mu, a} &:= \hat g^i(\nabla_\mu, -E_a)=0\\
    \hat g^i_{,ab} &:= \hat g^i(-E_a, -E_b) = \delta_{ab}
\end{align*}
where $g^i := S^{i*}\hat g|_{U_i}$ is \emph{the local trivialization of $\hat g$ over $U_i$}, i.e.
\begin{equation}
    \hat g^i = g^i_{\mu \nu} dx^\mu\otimes dx^\nu + h^i_{ab} \alg a^a \otimes \alg a^b;
\end{equation}
and so its \emph{local matrix representation} with respect to the same elements, i.e. with respect to $\{\nabla_\mu, -E_a\}$, is the following symmetric matrix:
\begin{equation}
    (\hat g^i) = \begin{pmatrix}  (g_{\mu \nu})_{\mu, \nu = 1, \dots, m} & 0 \\ 0 & (h_{a b})_{a, b = 1, \dots, n} \end{pmatrix}.
\end{equation}


\section{Inner Integration and Integration}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{definition}
The transitive Lie algebroid \emph{$A$ is inner orientable} if the adjoint Lie algebroid $L$ is an orientable vector bundle.
\end{definition}

Since the matrices ${G^i_j}^a_b$ represent the transition functions of $L$, where $a, b \in \{1, \dots, n\}$ and $i, j \in I$ such that $U_{ij \neq \emptyset}$ , $A$ is inner orientable if and only if $det({G^i_j}) \geq 0$.

For the rest of the section, let $A$ be inner orientable, and let $\hat g$ be an inner non-degenerate metric on $A$ with $(g, h, \nabla)$ its associated triple. In \cite{Fournel2013} it has been checked that:

\begin{proposition}\label{propositionInnerVolumeFormIntegrationFOrmGloballyDefinedWell}
For $i, j \in I$ such that $U_{ij \neq \emptyset}$,
\begin{equation*}
    \hat \alpha^i_j(\sqrt{|h^j|} \alg a_j^1 \wedge \cdots \wedge \alg a_j^n) = \sqrt{|h^i|} \alg a_i^1 \wedge \cdots \wedge \alg a_i^n \in \Omega^n(TU_{ij} \times \alg g),
\end{equation*}
where $\alg a = \alg a_i^a E_a$ is the connection form associated to $\nabla$, and $|h^i| \in C^\infty(U_i)$ denotes the absolute value of the determinant of $h$ over $U_i$, which is simply the absolute value of the determinant of the matrix $(h_{ab})$.
\end{proposition}
% \begin{proof}

% \end{proof}
\todo{}

Thanks to the previous proposition, the following form is well defined globally:
\begin{definition}
The global form $\omega_{h, \alg a} \in \Omega^n(A)$ whose local trivializations with respect to the connection $\nabla$ and the basis $\{E_a\}$ over each $U_i$ are
\begin{equation*}
    (\omega_{h, \alg a})_i = (-1)^n \sqrt{|h^i|} \alg a_i^1 \wedge \cdots \wedge \alg a_i^n
\end{equation*}
is called \emph{the inner volume form of $A$} with respect to $h$ and $\nabla$ and, recall, $n = dim(\alg g)$.
\end{definition}

\begin{theorem}\label{theoremIntegratedFormFactorInnerVolumeFOrmWellGloballyDefined}
Suppose that $\beta \in \Omega^\bullet(A, E)$, and let its decomposition with respect to the connection $\nabla$ and the basis $\{E_a\}$ over $U_i$ be
\begin{equation*}
    \beta_i = \beta^{M}_i \wedge \omega_{h, \alg a}%(-1)^n \sqrt{|h^i|} \alg a_i^1 \wedge \cdots \wedge \alg a_i^n 
    + \beta^R,
\end{equation*}
where $\beta^R$ is the sum of the terms which do not have $\alg a_i^1 \wedge \cdots \wedge \alg a_i^n$ as a factor. Then, $\beta_i^M \in \Omega_{U_i}(A, E)$ is the local trivialization over $U_i$ of a globally defined form $\beta^M$.

Furthermore, $\beta_i^M$ is also the term of the decomposition of $\beta$ over $U_i$ that multiplies the maximum inner degree term $\sqrt{|h_i|} \epsilon^1 \wedge \cdots \wedge \epsilon^n$, hence $\beta^M$ only depends on $h$.
\end{theorem}

\begin{proof}
Thanks to the homogeneous transformation rules \ref{}, for all $j \in I$ such that $U_{ij} \neq \emptyset$, $\hat \alpha^i_j(\beta^R)$ does not have any term with $\alg a_j^1 \wedge \cdots \wedge \alg a_j^n$ as factor, and so, since $\hat \alpha^i_j$ respects the wedge product, proposition \ref{propositionInnerVolumeFormIntegrationFOrmGloballyDefinedWell} implies that
\begin{equation}
    \hat \alpha^j_i(\beta^{M}_i) = \beta^{M}_j.
\end{equation}

The last part of the theorem is follows simply from decomposing each $\alg a_i^a \in \Omega^1(TU_i \times \alg g)$ as $A_i^a - \epsilon^a$, showing that the term that accompanies $\epsilon^1 \wedge \cdots \wedge^n$ in the decomposition of $\beta$ with respect to the local frame $\{dx^\mu, \epsilon^a\}$, if it exists, is precisely the same term that accompanies $(-1)\alg a_i^1 \wedge \cdots \wedge \alg a_i^n$ in the decomposition of $\beta$ with respect to the frame $\{dx^\mu, \alg a^a\}$, where $x^\mu: U_i\to \RR$, $mu = 1, \dots , m$ are any (auxiliary) coordinates defined in perhaps smaller open subsets of $U_i$ that cover it; since $\hat \alpha^i_j(dx^\mu) = dx^\mu$, it does not matter that the coordinates $x^\mu$ are not defined globally.
\end{proof}


\begin{definition}
On the inner orientable transitive Lie algebroid $A$ with inner non-degenerate metric $\hat g$, define \emph{the inner integration of forms on $A$} as the operation:
\begin{align}
    \int_{inner} &: \Omega^\bullet(A) \to \Omega^\bullet(TM)
    & \beta &\mapsto \beta^M,
\end{align}
where we used the notation of proposition \ref{theoremIntegratedFormFactorInnerVolumeFOrmWellGloballyDefined}.
\end{definition}
The previous definition can be extended with the same formula to integration of $E$-valued forms, but we only state this definition since it suffices for our purposes of defining the action functional of a gauge theory.

\begin{definition}
The transitive Lie algebroid $A$ is called \emph{orientable} if it is inner orientable and the base manifold $M$ is orientable.
\end{definition}

\begin{definition}
Let $A$ be an orientable transitive Lie algebroid with inner non-degenerate metric $\hat g$. Define \emph{the integration of scalar valued forms on $A$} as the operation
\begin{align}
    \int_A: \Omega^\bullet(A) &\to \bb K
    & \beta \mapsto \int_M \int_{inner} \beta,
\end{align}
applied to forms for which the corresponding integration over $M$ is well defined.
\end{definition}

\begin{remark}
Notice that the integration on $A$ only requires an inner metric $h$ on $A$ (to define $\int_{inner}$ and an orientable base manifold (to define $\int_M$), neither $g$ nor the connection $\nabla$ influence the integration of forms on $A$.
\end{remark}

However, to define an action functional we will require one more ingredient: the Hodge-$*$ operator of forms, which will require the full complexity of $\hat g$.

% \begin{definition}
% Let $h^E$ be a metric on $E$. Then 
% \end{definition}

\section{Horizontal Metrics and Hodge-$*$ Operator}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
The Hodge-$*$ operator enables the definition of the norm of a homogeneous $E$-valued form on $A$ of any degree, of which the gauge action functional and the matter action functional We will see in next chapter, which determine a gauge theory, will be examples.

For the rest of this chapter, let the transitive Lie algebroid $A$ be orientable and let $\hat g$ be a metric on $A$ (in particular, non-degenerate) associated to the triple $(g, h, \nabla)$, where $g$ and $h$ are (non-degenerate) metrics and $\nabla$ is an ordinary connection associated to the connection form $\alg a \in \Omega^1(A, L)$. Additionally, let $h^E$ be a metric on the representation vector bundle $E$. Finally, suppose that on each $U_i$ there are local coordinates $x^\mu: U_i \to \RR$, where $\mu = 1, \dots, m$.

\begin{definition}
\emph{The volume form $\omega^{Vol}$ on $A$ with respect to the metric $\hat g$} is the never zero top form $\Omega^{m+n}(A)$ with local trivialization over each $U_i$:
\begin{eqnsplit}
    \omega^{Vol}_i &= (-1)^n \sqrt{|g_i|} \sqrt{|h_i|} dx^1 \wedge \cdots \wedge dx^m \wedge \alg a^1 \wedge \cdots \wedge \alg a^n\\
    &= \sqrt{|g_i|} \sqrt{|h_i|} dx^1 \wedge \cdots \wedge dx^m \wedge \omega_{h, \alg a}.
\end{eqnsplit}
\end{definition}

\subsubsection{Inverse Metrics}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

The non-degeneracy of $\hat g$ implies that, over each $U_i$, the matrix representation of $\hat g^i$ with respect to the local frame $\{\nabla^i_\mu, -E_a\}_{\mu = 1, \dots, m;\, a = 1, \dots, n}$ is invertible, with inverse:
\begin{equation}
    (\hat g_i^{-1}) = \begin{pmatrix} (g^{\mu \nu})_{\mu, \nu = 1, \dots, m} & 0 \\ 0 & (h^{a b})_{a, b = 1, \dots, n} \end{pmatrix},
\end{equation}
where the matrix $(g^{\mu \nu})_{\mu, \nu = 1, \dots, m}$ is the inverse of the matrix of the matrix representation $(g_{\mu \nu})_{\mu, \nu = 1, \dots, m}$ of the induced metric on $TU_i$ and similarly for $(h^{a b})_{a, b = 1, \dots, n}$. We can use this to define a metric on the spaces of homogeneous forms of a given degree just as in the traditional $A = TM$ case.

\begin{definition}
\emph{The inverse metric of $\hat g$} is the symmetric, \dbtext{non-degenerate}, $C^\infty(M)$-linear (family of) map
\begin{equation}
    \hat g^{-1}: \Omega^p(A) \otimes \Omega^p(A) \to C^\infty(M, \RR),
\end{equation}
for all $p, q \in \ZZ_{\geq 0}$, such that its \emph{local trivialization $\hat g_i^{-1}$ over $U_i$}, i.e. the metric of $TU_i \times \alg g$ defined by $\hat g^{-1}|_{U_i}(\omega, \eta) = \hat g_i^{-1} (\omega_i, \eta_i)$ for all $\omega, \eta \in \Omega^p(A)$, satisfies:
\begin{equation*}
    \hat g_i^{-1} (\alpha, \beta) 
    = \sum_{r+s = p} \frac{1}{p!}  g^{\mu_1 \nu_1} \cdots g^{\mu_r \nu_r} h^{a_1 b_1} \cdots h^{a_s b_s} \alpha_{\mu_1 \dots \mu_r a_1 \dots a_s} \beta_{\nu_1 \dots \nu_r b_1 \dots  b_s},
\end{equation*}
for all $\alpha, \beta \in \Omega^p(TU_i \times \alg g)$ and using their decomposition with respect to the local mixed basis induced by the connection $\nabla$. 

Using the notation
\begin{equation}
    \beta^{\mu_1 \dots \mu_r a_1 \dots a_s} := g_i^{\mu_1 \nu_1} \cdots g^{\mu_r \nu_r} h^{a_1 b_1} \cdots h_i^{a_s b_s} \beta_{\nu_1 \dots \nu_r b_1 \dots  b_s},
\end{equation}
which defines an element $\beta^\#$ in the dual module of $\Omega^p(A)$, we may also write, then,
\begin{equation}
    \hat g_i^{-1}(\alpha, \beta) = \sum_{r+s = p} \frac{1}{p!} \alpha_{\mu_1 \dots \mu_r a_1 \dots a_s} \beta^{\mu_1 \dots \mu_r a_1 \dots  a_s}.
\end{equation}
\end{definition}

That the inverse metric is a well defined global element follows from the transformation laws of the components of a form, given in theorem \ref{theoremTransformationLawOfFormsComponentsFOrMixedLocalBasisDecomposition}, and the transformation law of the inverse metric,
\begin{equation}
    h_i^{a_1 b_1} = {G^i_j}^{a_1}_{a_1'} {G^i_j}^{b_1}_{b_1'} h_j^{a_1' b_1'}
\end{equation}
that follows from \ref{propositionTransformationLawMetricHGeneralBUndleRepresentation}, which is inverse to that of the components; concretely, for $\omega, \eta \in \Omega^p(A)$, over $U_{ij} \neq \emptyset$ it is satisfies that
\begin{align*}
    \hat g_j^{-1}(\omega_i, \eta_i) 
        &= \sum_{r+s = p} \frac{1}{p!} g_i^{\mu_1 \nu_1} \cdots g_i^{\mu_r \nu_r} h_i^{a_1 b_1} \cdots h_i^{a_s b_s} (\omega_i)_{\mu_1 \dots \mu_r a_1 \dots a_s} (\eta_i)_{\nu_1 \dots \nu_r b_1 \dots  b_s}\\
        &= \sum_{r+s = p} \frac{1}{p!} g_j^{\mu_1 \nu_1} \cdots g_j^{\mu_r \nu_r} 
        ({G^i_j}^{a_1}_{a_1'} {G^i_j}^{b_1}_{b_1'} h_j^{a_1' b_1'}) \cdots 
        ({G^i_j}^{a_s}_{a_s'} {G^i_j}^{b_s}_{b_s'} h_j^{a_s' b_s'}) \times \\
         &\quad  {G^j_i}^{a_1}_{a_1'}\cdots {G^i_j}^{a_s}_{a_s'} (\omega_j)_{\mu_1 \dots \mu_r a_1' \dots a_s'} \, {G^j_i}^{b_1}_{b_1'}\cdots {G^i_j}^{b_s}_{b_s'} (\eta_j)_{\nu_1 \dots \nu_r b_1' \dots  b_s'}\\
        &= \sum_{r+s = p} \frac{1}{p!} g_j^{\mu_1 \nu_1} \cdots g_j^{\mu_r \nu_r} h_j^{a_1 b_1} \cdots h_j^{a_s b_s} (\omega_j)_{\mu_1 \dots \mu_r a_1 \dots a_s} (\eta_j)_{\nu_1 \dots \nu_r b_1 \dots  b_s}\\
        &= \hat g_j^{-1}(\omega_j, \eta_j) .
\end{align*}

Similarly, letting $h^E$ be a metric on the representation vector bundle $E$, with typical fiber generated by the basis $\{e_u\}_{u = 1, \dots, t}$, we can define an ``inverse'' metric for $E$-valued forms:

\begin{definition}
\emph{The inverse metric $\hat g_{h^E}^{-1}$ on $E$-valued forms induced by $h^E$} is the symmetric, \dbtext{non-degenerate}, $C^\infty(M)$-linear map
\begin{equation}
    \hat g^{-1}_{h^E}: \Omega^p(A, E) \otimes \Omega^p(A, E) \to C^\infty(M, \RR),
\end{equation}
with local trivialization $g^{-1}_{i, h^E}$ over $U_i$ defined by
\begin{equation}
    \hat g_{h^E, i}^{-1}(\alpha_i, \beta_i) := \hat g_{i}^{-1}(\alpha_i^u, \beta_i^v) h^E_{uv}.
\end{equation}
Using the notation
\begin{equation}
    \beta_v^{\mu_1 \dots \mu_r a_1 \dots a_s} := h^E_{uv} g_i^{\mu_1 \nu_1} \cdots g^{\mu_r \nu_r} h^{a_1 b_1} \cdots h_i^{a_s b_s} \beta^u_{\nu_1 \dots \nu_r b_1 \dots  b_s},
\end{equation}
we may also write, then,
\begin{equation}
    \hat g_{h^E, i}^{-1}(\alpha, \beta) = \sum_{r+s = p} \frac{1}{p!} \alpha^u_{\mu_1 \dots \mu_r a_1 \dots a_s} \beta_u^{\mu_1 \dots \mu_r a_1 \dots  a_s}.
\end{equation}
\end{definition}

\subsubsection{Hodge-$*$ Operator}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{definition}\label{definitionHodgeStarFOrmula}
The Hodge-$*$ operator is the $C^\infty(M)$-linear (family of) operator
\begin{eqnsplit*}
    * : \Omega^p(A, E) &\to \Omega^{m+n-p}(A, E)\\
    \alpha &\mapsto *\alpha
\end{eqnsplit*}
for all $p \in \ZZ_{\geq 0}$, where the element \emph{$* \alpha \in \Omega^{m+n-p}(A, E)$} is defined to be $*\alpha := \alpha \omega^{Vol}$ if $p = 0$, or, otherwise, by the local trivializations:
\begin{eqnsplit}
    (*\alpha)_i &= \sum_{r+s = p} (-1)^{s(m-r)+n} \frac{1}{r!s!(m+n-p)!} \sqrt{|h_i|} \sqrt{|g_i|} (\alpha_i)_{\mu_1 \dots \mu_r a_1 \dots a_s} \vepsilon_{\nu_1 \dots \nu_m}  \vepsilon_{b_1 \dots b_n}\\
    &\quad \times g^{\mu_1 \nu_1} \cdots g^{\mu_r \nu_r} h^{a_1 b_1} \cdots h^{a_s b_s} dx^{\nu_{r+1}} \wedge \cdots \wedge dx^{\nu_{m}} \wedge \alg a^{b_{s+1}} \wedge \cdots \wedge \alg a^{b_n} \\
    &= \sum_{r+s = p} (-1)^{s(m-r)+n} \frac{1}{r!s!(m+n-p)!} \sqrt{|h_i|} \sqrt{|g_i|} (\alpha_i)^{\nu_1 \dots \nu_r b_1 \dots b_s} \vepsilon_{\nu_1 \dots \nu_m}  \vepsilon_{b_1 \dots b_n} \\
    &\quad \times dx^{\nu_{r+1}} \wedge \cdots \wedge dx^{\nu_{m}} \wedge \alg a^{b_{s+1}} \wedge \cdots \wedge \alg a^{b_n}
\end{eqnsplit}
where $\vepsilon$ are the totally antisymmetric Levi-Civita symbols.
\end{definition}

That the previous local trivializations do define a global form $*\alpha$ follows easily from the multiplication of the inverse $(G^i_j)$ matrices that appear when applying $\hat \alpha^i_j$, for $U_{ij} \neq \emptyset$, due to the transformations of $\sqrt{|h_i|}$, of the components of the inverse inner metric, of the components of $\alpha$ and of the subfactors of the inner volume element. Notice that $(*\alpha)_i = *(\alpha_i)$ by definition, so we may simply write $*\alpha_i$; also, notice that with respect to the basis $\{e_u\}$ of the typical fiber $V$ of $E$, $*\alpha_i = (*\alpha_i^u)e_u$.

\begin{proposition}\label{propositionRelationHodgeStarAndInverseMetricVolume}
The Hodge-$*$ operator is such that the following identity is satisfied:
\begin{equation}
    h_E(\alpha, *\beta) = \hat g_{h^E}^{-1}(\alpha, \beta) \omega^{Vol},
\end{equation}
for all $\alpha, \beta \in \Omega^p(A, E)$ and all $p \in \ZZ_{\geq 0}$.
\end{proposition}

\begin{proof}
This can be proved through a combinatorial argument once we expand $$\alpha_i^u = \sum_{r+s} \alpha_{\nu_1 \dots b_s} e_u dx^{\nu_1} \wedge \cdots \wedge \alg a^{b_s}$$ and $*\beta_i$ as in the second equation of definition \ref{definitionHodgeStarFOrmula}, replace these formulas in $h^i_E(\alpha_i, *\beta_i) = (h^E_i)_{uv} \alpha_i^u \wedge * \beta_i^v$, expanding the wedge product and reordering the $dx$'s and $\alg a$'s in order to isolate $\omega^{Vol}$.
\end{proof}

\begin{definition}
\emph{The scalar product on each $\Omega^p(A, E)$ induced by the metrics $\hat g$ on $A$ and $h^E$ on $E$} 
%\todo{is it an actual scalar product? Is it non-degenrate? Do we want it to be able to be complex valued? In that case metric might not be the best term} 
in the orientable transitive Lie algebroid $A$, for all $p \in \ZZ_{\geq 0},$ is defined by
\begin{equation*}
    (\alpha, \beta) := \int_A h^E(\alpha, *\beta).
\end{equation*}
When $E = L$, $h^E$ is assumed to be $h$, the inner part of $\hat g$.
\end{definition}

% \begin{theorem}\label{theoremDecompositionOfScalarProductOfHomogeneousFormsForLagrangian}
% For any $\alpha, \beta \in \Omega^p(A, E)$, $p \in \ZZ_{\geq 0}$,
% \begin{multline*}
%     (\alpha, \beta) = (-1)^n \sum_{r + s = p} (-1)^{s(m-s)} (m-r)! (n-s)! \times \\
%     \int_M \alpha^u_{\mu_1 \dots a_s} \beta_u^{\mu_1 \dots a_s} \sqrt{|g|} dx^1 \wedge \cdots \wedge dx^m. 
% \end{multline*}
% \end{theorem}

We now have all the necessary ingredients to define the action functional of a gauge theory, which will be studied in next chapter.